{% extends "base_with_rslider.html" %}


{% block content %}

    <div id="Main">
        <div class="sep20"></div>
        {% block main %}
            <div class="box">
                <div class="inner"
                     style="background-color: #fff; border-top-left-radius: 3px; border-top-right-radius: 3px;"
                     id="Tabs">
                    {% for obj in category_obj %}
                        {% if current_tab == obj.code %}
                            <a class="btn btn-sm btn-secondary"
                               href="{% url 'index' %}?tab={{ obj.code }}">{{ obj.name }}</a>
                        {% else %}
                            <a class="btn btn-sm btn-light"
                               href="{% url 'index' %}?tab={{ obj.code }}">{{ obj.name }}</a>
                        {% endif %}
                    {% endfor %}
                </div>
                {% if not category_obj.hot %}
                    <div class="cell" style="background-color: #f9f9f9; padding: 10px 10px 10px 20px;">
                        {% for obj in category_children_obj %}
                            <a href="{% url 'node' obj.code %}" class="badge badge-dark">{{ obj.name }}</a>
                        {% endfor %}
                    </div>
                {% endif %}
                {% for obj in topic_obj %}
                    <div class="cell item">
                        <table cellpadding="0" cellspacing="0" border="0" width="100%">
                            <tbody>
                            <tr>
                                <td width="48" valign="top" align="center">
                                    <a href="{% url 'member' obj.author.username %}">
                                        {% if obj.author.socialaccount_set.all.0.get_avatar_url %}
                                            <img src="{{ obj.author.socialaccount_set.all.0.get_avatar_url }}"
                                                 class="rounded" alt="{{ obj.author.username }}"
                                                 width="48px" height="48px" border="0" align="default">

                                        {% else %}
                                            <img src="{{ obj.author.avatar.url }}" class="rounded"
                                                 alt="{{ obj.author.username }}"
                                                 width="48px" height="48px" border="0" align="default">
                                        {% endif %}

                                    </a>
                                </td>
                                <td width="10"></td>
                                <td width="auto" valign="middle">
                                    <span class="item_title"><a
                                            href="{% url 'topic' obj.topic_sn %}">{{ obj.title|safe }}</a></span>
                                    <div class="sep5"></div>
                                    <span class="small">
                            <div class="votes"></div>
                            <a class="node" href="{% url 'node' obj.category.code %}">{{ obj.category.name }}</a> &nbsp;•&nbsp;
                            <strong>
                                <a href="{% url 'member' obj.author.username %}">{{ obj.author.username }}</a>
                            </strong>
                                        {% if obj.last_comment_user %}
                                            &nbsp;•&nbsp; {{ obj.last_comment_time }} &nbsp;•&nbsp; 最后回复来自
                                            <strong>
                                    <a href="{% url 'member' obj.last_comment_user %}">{{ obj.last_comment_user }}</a>
                                </strong>
                                        {% endif %}
                        </span>
                                </td>
                                <td width="70" align="right" valign="middle">
                                    <a href="{% url 'topic' obj.topic_sn %}"
                                       class="read_status badge badge-pill badge-secondary">&nbsp;{{ obj.comment_num }}&nbsp;</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                {% endfor %}

                <!-- 列表循环 -->
                {% for obj in topic_obj %}
                    <div class="card mb-2">
                        <div class="row no-gutters align-items-center">
                            <a href="{% url 'member' obj.author.username %}">
                                {% if obj.author.socialaccount_set.all.0.get_avatar_url %}
                                    <img src="{{ obj.author.socialaccount_set.all.0.get_avatar_url }}" class="rounded"
                                         alt="{{ obj.author.username }}"
                                         width="48px" height="48px" border="0" align="default">

                                {% else %}
                                    <img src="{{ obj.author.avatar.url }}" class="rounded"
                                         alt="{{ obj.author.username }}"
                                         width="48px" height="48px" border="0" align="default">
                                {% endif %}
                            </a>
                            <div class="col">

                                <div class="card-body">
                                    <!-- 标题 -->
                                    <h3 class="mt-0">
                                        <a href="{% url 'topic' obj.topic_sn %}">{{ obj.title|safe }}</a>
                                    </h3>

                                    <a class="node"
                                       href="{% url 'node' obj.category.code %}">{{ obj.category.name }}</a> &nbsp;•&nbsp;
                                    <strong>
                                        <a href="{% url 'member' obj.author.username %}">{{ obj.author.username }}</a>
                                    </strong>
                                    <!-- 附加信息 -->
                                    {% if obj.last_comment_user %}
                                        &nbsp;•&nbsp; {{ obj.last_comment_time }} &nbsp;•&nbsp; 最后回复来自
                                        <strong>
                                            <a href="{% url 'member' obj.last_comment_user %}">{{ obj.last_comment_user }}</a>
                                        </strong>
                                    {% endif %}

                                    <td width="70" align="right" valign="middle">
                                        <a href="{% url 'topic' obj.topic_sn %}"
                                           class="read_status badge badge-pill badge-secondary">&nbsp;{{ obj.comment_num }}&nbsp;</a>
                                    </td>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                <div class="inner">
                    <span class="chevron">→</span> <a href="{% url 'recent' %}">更多新主题</a>
                </div>
            </div>
        {% endblock %}
    </div>
    {% if is_login %}
        {% csrf_token %}
    {% endif %}



    <script src="/static/js/jquery-3.3.1.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/plugin/highlight/highlight.pack.js"></script>

    <script>
        /* Ajax 初始化请求操作*/
        $(function () {
            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));
                }
            });
        });
        /* title 变化 */
        document.addEventListener("visibilitychange", function () {
            if (document.hidden) {
                $('title').text('V2EX');
            } else {
                $('title').text('欢迎回来ヽ(✿ﾟ▽ﾟ)ノ');
                setTimeout("$('title').text('V2EX');", 3000);
            }
        }, false);

    </script>
    <script>hljs.initHighlightingOnLoad();</script>
    {% block JS %} {% endblock %}

{% endblock %}